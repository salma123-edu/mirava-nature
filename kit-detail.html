<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DÃ©tail coffret - MIRAVA NATURE</title>
  <link rel="stylesheet" href="css/style.css?v=3.1" />
</head>

<body>
  <!-- header shared -->
  <header>
    <div class="container">
      <a href="index.html">
        <img src="images/logo.png" alt="Logo Mirava Nature" />
      </a>
      <button class="mobile-menu-toggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <nav>
        <a href="index.html">Accueil</a>
        <a href="products.html">Produits</a>
        <a href="kits.html" class="active">Coffrets</a>
        <a href="contact.html">Contact</a>
        <div id="auth-nav-area"></div>
        <div class="cart-container">
          <button id="cart-toggle" class="cart-btn">ðŸ›’ Panier (<span id="cart-count">0</span>)</button>
          <div id="mini-cart" class="mini-cart" aria-hidden="true">
            <h4>Votre panier</h4>
            <div id="mini-cart-items"></div>
            <p id="mini-cart-total" class="mini-cart-total">Panier vide</p>
            <a href="panier.html" class="btn-mini-cart">Voir le panier</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main style="padding: 60px 0;">
    <section class="container" id="kit-detail"></section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 MIRAVA NATURE</p>
    </div>
  </footer>

  <script src="js/auth.js"></script>
  <script src="js/main.js"></script>
  <script src="js/cart.js"></script>
  <script src="products-data.js"></script>
  <script src="kits-data.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      const container = document.getElementById('kit-detail');
      if (!id || typeof allKits === 'undefined') {
        container.innerHTML = '<p>Coffret introuvable.</p>';
        return;
      }
      const kit = allKits[id];
      if (!kit) { container.innerHTML = '<p>Coffret introuvable.</p>'; return; }

      // Construire contenu des produits du coffret
      const contentsHtml = (kit.contents || []).map(pid => {
        const p = (typeof allProducts !== 'undefined' && allProducts[pid]) ? allProducts[pid] : null;
        const img = p ? p.image : 'images/placeholder.png';
        const name = p ? p.name : pid;
        return `
        <div class="kit-item" data-pid="${pid}" style="text-align: center; background: white; padding: 15px; border-radius: 16px; border: 1px solid #f5f5f5;">
          <img src="${img}" alt="${name}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
          <div style="font-weight:600; font-size: 14px;">${name}</div>
        </div>
      `;
      }).join('');

      container.innerHTML = `
      <div class="detail-layout">
        <div class="product-media">
          <img src="${kit.image}" alt="${kit.name}" class="detail-img" />
        </div>
        <div class="detail-info">
          <h1>${kit.name}</h1>
          <p class="detail-price">${kit.price} MAD</p>
          <p class="detail-desc">${kit.short_description || ''}</p>
          
          <div style="margin-bottom: 40px;">
            <button id="add-kit" class="btn-premium" style="width: 100%;">Ajouter le coffret au panier</button>
          </div>

          <h3>Contenu du coffret</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px;">
            ${contentsHtml}
          </div>
        </div>
      </div>
    `;

      const addKitBtn = document.getElementById('add-kit');
      if (addKitBtn) {
        addKitBtn.addEventListener('click', () => {
          const item = { id: kit.id, name: kit.name, price: kit.price, qty: 1, image: kit.image };
          if (typeof window.addToCart === 'function') {
            window.addToCart(item);
          }
          addKitBtn.textContent = 'âœ… AjoutÃ© au panier';
          addKitBtn.classList.remove('btn-premium');
          addKitBtn.style.background = '#2D4F3C';
          addKitBtn.style.color = 'white';
          setTimeout(() => {
            addKitBtn.textContent = 'Ajouter le coffret au panier';
            addKitBtn.classList.add('btn-premium');
            addKitBtn.style.background = '';
          }, 1500);
        });
      }
    });

    function escapeHtml(s) { return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;'); }
  </script>
</body>

</html>